<?php 
$categories = $block->getActiveCategoryCollection()->setOrder('name','ASC');;

$html = "<ul class='level-0' >";
foreach($categories as $category){
    if(empty($category->getChildren()) && $category->getLevel() == 2){
        $html .= "<ul>";
            $html .= "<li>";
                $html .= "<a href='".$category->getUrl()."' >";
                    $html .= "<span>";
                        $html .= $category->getName();
                    $html .= "</span>";
                $html .= "</a>";
            $html .= "</li>";
        $html .= "</ul>";
    }elseif(!empty($category->getChildren()) && $category->getLevel() == 2){
        $level = $category->getLevel();
        $html .= childrenList($category, $categories, $level);
    }
}
$html .= "</ul>";

function childrenList($category, $categories, $level){
    $level++;
    $html = "<ul class='group-hover'>";
        $html .= "<li>";
            $html .= "<a class='has-child' href='".$category->getUrl()."' >";
                $html .= "<span>";
                    $html .= $category->getName();
                $html .= "</span>";
            $html .= "</a>";
        $html .= "</li>";
        $html .= "<ul class='group'>";
            foreach($categories as $categoryLevel){
                if(empty($categoryLevel->getChildren()) && $categoryLevel->getLevel() == $level && $categoryLevel->getParentId() == $category->getId()){
                    $html .= "<ul>";
                        $html .= "<li>";
                            $html .= "<a href='".$categoryLevel->getUrl()."' >";
                                $html .= "<span>";
                                    $html .= $categoryLevel->getName();
                                $html .= "</span>";
                            $html .= "</a>";    
                        $html .= "</li>";
                    $html .= "</ul>";
                }elseif(!empty($categoryLevel->getChildren()) && $categoryLevel->getLevel() == $level && $categoryLevel->getParentId() == $category->getId()){
                    $html .= childrenList($categoryLevel, $categories, $level);
                }
            }
        $html .= "</ul>";
    $html .= "</ul>";

    return $html;
}
?>

<div class="deco-menu-wrapper">
    <div class="deco-menu">
        <div>
            <div class="btn-menu" >
                Categorias
            </div>
            <div>
                <?= $html ?>
            </div>
        </div>
    </div>
</div>

<script>
require([
    'jquery',
    'domReady!'
], function ($) {
    var level0;
    var group;
    var qtdUlMax;
    var height;
    var liHeight = 28;

    level0Ul = document.querySelectorAll(".deco-menu .level-0 > ul");
    group = document.querySelectorAll(".deco-menu .level-0 .group");
    li = document.querySelectorAll(".deco-menu li");

    qtdUlMax = level0Ul.length;

    for(i=0;i<group.length;i++){
        if(group[i].children.length > qtdUlMax){
            qtdUlMax = group[i].children.length;
        }
    }

    for(i=0;i<li.length;i++){
        li[i].style.height = liHeight + "px";
    }

    height = (liHeight * qtdUlMax);

    level0 = document.querySelectorAll(".deco-menu .level-0");
    level0[0].style.height = height + "px";

    for(i=0;i<group.length;i++){
        group[i].style.height = height + "px";
    }
});
</script>
